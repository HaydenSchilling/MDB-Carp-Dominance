library(lubridate)
#all_data <- read.csv("../../Murray cod recruitment/All_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
all_data <- read.csv("clean waterbody_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
site_dets <- all_data %>% select(SiteName, SiteID) %>% distinct()
segments <- all_data %>% distinct(project_segment) %>% arrange(project_segment)
bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
"Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
"Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
"Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
"Murray Cod Slot Limit Assessment:2020/Extra")
bad2 <- segments %>% filter(grepl("*Extra*",project_segment)) # all extra fishing
bad3 <- segments %>% filter(grepl("*Selective*",project_segment)) # all extra fishing
#all_data
all_data <- all_data %>% filter(!project_segment %in% bad_list) %>%
filter(!project_segment %in% bad2$project_segment) %>%
filter(!project_segment %in% bad3$project_segment) %>%
select(-1,-2,-3,-project_segment) %>%
distinct() %>%
filter(Method == "BTE"| Method == "BPE")%>%
mutate(EffortData = str_replace_all(EffortData, pattern = "\"\"", replacement = "\"")) %>%
mutate(boat = str_extract(EffortData, pattern="\"ElectrofishingDuration\"......"),
ESecs = parse_number(boat),
boat = NULL) %>% drop_na(ESecs)
# back <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BPE")
#
# boat <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BTE")
basins <- c("Barwon-Darling Watercourse", "Gwydir", "Intersecting Streams",
"Lachlan", "Macquarie-Castlereagh", "Murrumbidgee", "Namoi",
"New South Wales Border Rivers", "New South Wales Murray",
"New South Wales Lower Darling") #
all_data <- all_data %>% #filter(CommonName == "Golden perch") %>%
filter(SWWRPANAME_NEW %in% basins)
elevation_dat <- read_csv("Data/Site elevations.csv") %>% rename(SampleLongitude = coords.x1, SampleLatitude = coords.x2)
all_data <- all_data %>% left_join(elevation_dat) %>% select(-elevation, -elev_units)
#write_csv(all_data, "Data/2024 full with lats lons.csv")
#
#### Just checking this dataset is the same (it is but above has SWRPANAME)
# catch <- read_csv("clean boat electro catch with waterbody.csv") %>% # filter(Method == "Boat Electrofishing")
#   mutate(project_segment = paste0(ProjectName,":",SegmentName)) %>% distinct()# %>% filter(WaterbodyName == "Murray River")
#
# segments <- catch %>% distinct(project_segment) %>% arrange(project_segment)
#
# bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
#               "Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
#               "Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
#               "Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
#               "Murray Cod Slot Limit Assessment:2020/Extra")
#
# catch <- catch %>% filter(!project_segment %in% bad_list) %>% filter(Method == "BTE") %>% select(-1,-2,-3,-project_segment) %>%
#   distinct()
#
#
# b2 <- read_csv("data/All bio_27_01_2022.csv") %>% select(CommonName, a, b) %>% distinct()
# write_csv(b2, "Data/a b values.csv")
ab <- read_csv("Data/a b values.csv")
bio <- read_csv("../../Murray cod recruitment/All bio_11_08_2023.csv")  %>% left_join(ab) %>%
mutate(CalcWeight = 10^(a)*Length_mm^b)
bio_summary <- bio %>% group_by(CommonName, OperationID) %>%
summarise(biomass_mean = mean(CalcWeight, na.rm=T))
catch2 <- all_data %>% left_join(bio_summary) %>% mutate(Taxa_biomass = biomass_mean * NumberCaught)
catch_total_biomass <- catch2  %>%
ungroup() %>% group_by(SamplingRecordID) %>%
summarise(Total_biomass = sum(Taxa_biomass, na.rm=T))
# method change
meths <- catch2 %>% select(SamplingRecordID, Method) %>% distinct() %>%
group_by(SamplingRecordID) %>% summarise(method_N =n())
table(meths$method_N)
catch2 <- catch2 %>% left_join(meths) %>% mutate(Method = case_when(method_N == 2 ~ "Hybrid",
T ~ Method)) %>%
select(-method_N)
table(catch2$Method)
duds <- c("Alpine Spiny Crayfish", "Australian Water Rat", "Bengal sergeant",
"Black bream", "Broad-shelled turtle", "Clayton's Spiny Crayfish",
"Eastern long-necked tortoise", "Eastern water dragon",
"Freshwater prawn, Murray crayfish", "Murray short-necked turtle",
"Platypus", "Riek's crayfish", "River mussel", "Shrimp",
"Sydney crayfish", "Trevally","Unidentified Euastacus",
"Unidentified Tadpole", "Unknown Shrimp", "Yabby",
"Zero catch at DRY site")
alien <- c("Common carp", "Redfin", "Eastern gambusia", "Goldfish", "Rainbow trout", "Brown trout",
"Oriental weatherloach", "Tilapia", "Roach", "Brook trout", "Common carp - Goldfish hybrid")
catch2 <- catch2 %>% filter(!CommonName %in% duds) %>% mutate(Alien = case_when(CommonName %in% alien ~ "Alien",
T ~ "Native"))
effort_by_op <- catch2  %>% group_by(OperationID) %>% summarise(ESecs = mean(ESecs, na.rm=T))
xx <- catch2 %>% filter(!CommonName %in% duds) %>%
group_by(Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Abund, names_from = Alien, values_fill = 0) %>%
pivot_longer(7:8, names_to = "Category", values_to = "Abund") %>%
left_join(effort_by_op) %>% drop_na(ESecs) %>% filter(ESecs >30) %>% mutate(Date = ymd_hms(SampleDate),
Year = year(Date),
Month = month(Date),
FinYear = case_when(Month>6 ~ Year+1,
T ~ Year),
FinYear = as.character(FinYear))
xx <- catch2 %>% filter(!CommonName %in% duds) %>%
group_by(OperationID, Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Biomass, names_from = Alien, values_fill = 0) %>%
pivot_longer(7:8, names_to = "Category", values_to = "Biomass") %>%
left_join(effort_by_op) %>% drop_na(ESecs) %>% filter(ESecs >30) %>% mutate(Date = ymd_hms(SampleDate),
Year = year(Date),
Month = month(Date),
FinYear = case_when(Month>6 ~ Year+1,
T ~ Year),
FinYear = as.character(FinYear))
View(xx)
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs),
Total_Biomass = sum(Biomass),
std_Biomass = Biomass/Effort * 90) %>% filter(FinYear <2024)
View(mod_dat)
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs),
Total_Biomass = sum(Biomass),
std_Biomass = Biomass/Effort * 90) %>% filter(FinYear <2024)
View(dat_sum)
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% ungroup() %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs),
Total_Biomass = sum(Biomass),
std_Biomass = Biomass/Effort * 90) %>% filter(FinYear <2024)
View(dat_sum)
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs),
Total_Biomass = sum(Biomass),
std_Abund = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Abund = mean(std_Abund),
sd_Abund = mean(std_Abund),
n=n(),
se_Abund = sd_Abund/sqrt(n))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs),
Total_Biomass = sum(Biomass),
std_Biomass = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass),
sd_Biomass = mean(std_Biomass),
n=n(),
se_Biomass = sd_Abund/sqrt(n))
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass),
sd_Biomass = mean(std_Biomass),
n=n(),
se_Biomass = sd_Biomass/sqrt(n))
dat_sum2$Category_f = factor(dat_sum2$Category, levels=c('Native','Alien'))
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (g; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
View(dat_sum2)
View(dat_sum2)
View(dat_sum)
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs, na.rm=T),
Total_Biomass = sum(Biomass, na.rm=T),
std_Biomass = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass, na.rm=T),
sd_Biomass = mean(std_Biomass, na.rm=T),
n=n(),
se_Biomass = sd_Biomass/sqrt(n, na.rm=T))
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass, na.rm=T),
sd_Biomass = mean(std_Biomass, na.rm=T),
n=n(),
se_Biomass = sd_Biomass/sqrt(n))
dat_sum2$Category_f = factor(dat_sum2$Category, levels=c('Native','Alien'))
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (g; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs, na.rm=T),
Total_Biomass = sum(Biomass, na.rm=T)/1000,
std_Biomass = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass, na.rm=T),
sd_Biomass = mean(std_Biomass, na.rm=T),
n=n(),
se_Biomass = sd_Biomass/sqrt(n))
dat_sum2$Category_f = factor(dat_sum2$Category, levels=c('Native','Alien'))
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (kg; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
ggsave("Matter 8 Mean Biomass Plot.png", dpi = 300, width = 15, height=14, units="cm")
ggsave("Matter 8 Mean Biomass Plot.png", dpi = 300, width = 15, height=14, units="cm")
#### Overall NSW Basin
library(tidyverse)
library(lubridate)
#all_data <- read.csv("../../Murray cod recruitment/All_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
all_data <- read.csv("clean waterbody_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
site_dets <- all_data %>% select(SiteName, SiteID) %>% distinct()
segments <- all_data %>% distinct(project_segment) %>% arrange(project_segment)
bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
"Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
"Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
"Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
"Murray Cod Slot Limit Assessment:2020/Extra")
bad2 <- segments %>% filter(grepl("*Extra*",project_segment)) # all extra fishing
bad3 <- segments %>% filter(grepl("*Selective*",project_segment)) # all extra fishing
#all_data
all_data <- all_data %>% filter(!project_segment %in% bad_list) %>%
filter(!project_segment %in% bad2$project_segment) %>%
filter(!project_segment %in% bad3$project_segment) %>%
select(-1,-2,-3,-project_segment) %>%
distinct() %>%
filter(Method == "BTE"| Method == "BPE")%>%
mutate(EffortData = str_replace_all(EffortData, pattern = "\"\"", replacement = "\"")) %>%
mutate(boat = str_extract(EffortData, pattern="\"ElectrofishingDuration\"......"),
ESecs = parse_number(boat),
boat = NULL) %>% drop_na(ESecs)
duds <- c("Alpine Spiny Crayfish", "Australian Water Rat", "Bengal sergeant",
"Black bream", "Broad-shelled turtle", "Clayton's Spiny Crayfish",
"Eastern long-necked tortoise", "Eastern water dragon",
"Freshwater prawn, Murray crayfish", "Murray short-necked turtle",
"Platypus", "Riek's crayfish", "River mussel", "Shrimp",
"Sydney crayfish", "Trevally","Unidentified Euastacus",
"Unidentified Tadpole", "Unknown Shrimp", "Yabby",
"Zero catch at DRY site")
alien <- c("Common carp", "Redfin", "Eastern gambusia", "Goldfish", "Rainbow trout", "Brown trout",
"Oriental weatherloach", "Tilapia", "Roach", "Brook trout", "Common carp - Goldfish hybrid")
all_data <- all_data %>% mutate(Alien = case_when(CommonName %in% alien ~ "Alien",
CommonName %in% duds ~ "Other",
T ~ "Native"))
# back <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BPE")
#
# boat <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BTE")
basins <- c("Barwon-Darling Watercourse", "Gwydir", "Intersecting Streams",
"Lachlan", "Macquarie-Castlereagh", "Murrumbidgee", "Namoi",
"New South Wales Border Rivers", "New South Wales Murray",
"New South Wales Lower Darling") #
all_data <- all_data %>% #filter(CommonName == "Golden perch") %>%
filter(SWWRPANAME_NEW %in% basins)
elevation_dat <- read_csv("Data/Site elevations.csv") %>% rename(SampleLongitude = coords.x1, SampleLatitude = coords.x2)
all_data <- all_data %>% left_join(elevation_dat) %>% select(-elevation, -elev_units)
#write_csv(all_data, "Data/2024 full with lats lons.csv")
#
#### Just checking this dataset is the same (it is but above has SWRPANAME)
# catch <- read_csv("clean boat electro catch with waterbody.csv") %>% # filter(Method == "Boat Electrofishing")
#   mutate(project_segment = paste0(ProjectName,":",SegmentName)) %>% distinct()# %>% filter(WaterbodyName == "Murray River")
#
# segments <- catch %>% distinct(project_segment) %>% arrange(project_segment)
#
# bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
#               "Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
#               "Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
#               "Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
#               "Murray Cod Slot Limit Assessment:2020/Extra")
#
# catch <- catch %>% filter(!project_segment %in% bad_list) %>% filter(Method == "BTE") %>% select(-1,-2,-3,-project_segment) %>%
#   distinct()
#
#
# b2 <- read_csv("data/All bio_27_01_2022.csv") %>% select(CommonName, a, b) %>% distinct()
# write_csv(b2, "Data/a b values.csv")
ab <- read_csv("Data/a b values.csv")
bio <- read_csv("../../Murray cod recruitment/All bio_11_08_2023.csv")  %>% left_join(ab) %>%
mutate(CalcWeight = 10^(a)*Length_mm^b)
bio_summary <- bio %>% group_by(CommonName, OperationID) %>%
summarise(biomass_mean = mean(CalcWeight, na.rm=T))
catch2 <- all_data %>% left_join(bio_summary) %>% mutate(Taxa_biomass = biomass_mean * NumberCaught)
catch_total_biomass <- catch2  %>%
ungroup() %>% group_by(SamplingRecordID) %>%
summarise(Total_biomass = sum(Taxa_biomass, na.rm=T))
# method change
meths <- catch2 %>% select(SamplingRecordID, Method) %>% distinct() %>%
group_by(SamplingRecordID) %>% summarise(method_N =n())
table(meths$method_N)
catch2 <- catch2 %>% left_join(meths) %>% mutate(Method = case_when(method_N == 2 ~ "Hybrid",
T ~ Method)) %>%
select(-method_N)
table(catch2$Method)
duds <- c("Alpine Spiny Crayfish", "Australian Water Rat", "Bengal sergeant",
"Black bream", "Broad-shelled turtle", "Clayton's Spiny Crayfish",
"Eastern long-necked tortoise", "Eastern water dragon",
"Freshwater prawn, Murray crayfish", "Murray short-necked turtle",
"Platypus", "Riek's crayfish", "River mussel", "Shrimp",
"Sydney crayfish", "Trevally","Unidentified Euastacus",
"Unidentified Tadpole", "Unknown Shrimp", "Yabby",
"Zero catch at DRY site")
effort_by_op <- catch2  %>% group_by(OperationID) %>% summarise(ESecs = mean(ESecs, na.rm=T))
xx <- catch2 %>%
group_by(OperationID, Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Biomass, names_from = Alien, values_fill = 0) %>%
pivot_longer(7:8, names_to = "Category", values_to = "Biomass") %>%
left_join(effort_by_op) %>% drop_na(ESecs) %>% filter(ESecs >30) %>% mutate(Date = ymd_hms(SampleDate),
Year = year(Date),
Month = month(Date),
FinYear = case_when(Month>6 ~ Year+1,
T ~ Year),
FinYear = as.character(FinYear))
#### Overall NSW Basin
library(tidyverse)
library(lubridate)
#all_data <- read.csv("../../Murray cod recruitment/All_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
all_data <- read.csv("clean waterbody_catch_11_08_2023_with_fixed_WRPA.csv") %>% mutate(project_segment = paste0(ProjectName,":",SegmentName))
site_dets <- all_data %>% select(SiteName, SiteID) %>% distinct()
segments <- all_data %>% distinct(project_segment) %>% arrange(project_segment)
bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
"Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
"Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
"Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
"Murray Cod Slot Limit Assessment:2020/Extra")
bad2 <- segments %>% filter(grepl("*Extra*",project_segment)) # all extra fishing
bad3 <- segments %>% filter(grepl("*Selective*",project_segment)) # all extra fishing
#all_data
all_data <- all_data %>% filter(!project_segment %in% bad_list) %>%
filter(!project_segment %in% bad2$project_segment) %>%
filter(!project_segment %in% bad3$project_segment) %>%
select(-1,-2,-3,-project_segment) %>%
distinct() %>%
filter(Method == "BTE"| Method == "BPE")%>%
mutate(EffortData = str_replace_all(EffortData, pattern = "\"\"", replacement = "\"")) %>%
mutate(boat = str_extract(EffortData, pattern="\"ElectrofishingDuration\"......"),
ESecs = parse_number(boat),
boat = NULL) %>% drop_na(ESecs)
duds <- c("Alpine Spiny Crayfish", "Australian Water Rat", "Bengal sergeant",
"Black bream", "Broad-shelled turtle", "Clayton's Spiny Crayfish",
"Eastern long-necked tortoise", "Eastern water dragon",
"Freshwater prawn, Murray crayfish", "Murray short-necked turtle",
"Platypus", "Riek's crayfish", "River mussel", "Shrimp",
"Sydney crayfish", "Trevally","Unidentified Euastacus",
"Unidentified Tadpole", "Unknown Shrimp", "Yabby",
"Zero catch at DRY site")
alien <- c("Common carp", "Redfin", "Eastern gambusia", "Goldfish", "Rainbow trout", "Brown trout",
"Oriental weatherloach", "Tilapia", "Roach", "Brook trout", "Common carp - Goldfish hybrid")
all_data <- all_data %>% mutate(Alien = case_when(CommonName %in% alien ~ "Alien",
CommonName %in% duds ~ "Other",
T ~ "Native"))
# back <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BPE")
#
# boat <- all_data %>% filter(!project_segment %in% bad_list) %>% select(-1,-2,-3,-project_segment) %>%
#   distinct() %>%
#   filter(Method == "BTE")
basins <- c("Barwon-Darling Watercourse", "Gwydir", "Intersecting Streams",
"Lachlan", "Macquarie-Castlereagh", "Murrumbidgee", "Namoi",
"New South Wales Border Rivers", "New South Wales Murray",
"New South Wales Lower Darling") #
all_data <- all_data %>% #filter(CommonName == "Golden perch") %>%
filter(SWWRPANAME_NEW %in% basins)
elevation_dat <- read_csv("Data/Site elevations.csv") %>% rename(SampleLongitude = coords.x1, SampleLatitude = coords.x2)
all_data <- all_data %>% left_join(elevation_dat) %>% select(-elevation, -elev_units)
#write_csv(all_data, "Data/2024 full with lats lons.csv")
#
#### Just checking this dataset is the same (it is but above has SWRPANAME)
# catch <- read_csv("clean boat electro catch with waterbody.csv") %>% # filter(Method == "Boat Electrofishing")
#   mutate(project_segment = paste0(ProjectName,":",SegmentName)) %>% distinct()# %>% filter(WaterbodyName == "Murray River")
#
# segments <- catch %>% distinct(project_segment) %>% arrange(project_segment)
#
# bad_list <- c("Edward-Wakool Blackwater restocking:NETTING AND EXTRA E FISHING", "Edward-Wakool Blackwater restocking:NETTING AND EXTRA EFISHING",
#               "Edward-Wakool Blackwater restocking:NETTING AND EXTRA ELECTRO", "Koondrook Perricoota Accumulation Sites:2014",
#               "Koondrook Perricoota Accumulation Sites:2015", "Koondrook Perricoota Accumulation Sites:2016",
#               "Lachlan Carp Demo:GCS - YOY CARP", "Murray Cod Slot Limit Assessment:2019/Extra",
#               "Murray Cod Slot Limit Assessment:2020/Extra")
#
# catch <- catch %>% filter(!project_segment %in% bad_list) %>% filter(Method == "BTE") %>% select(-1,-2,-3,-project_segment) %>%
#   distinct()
#
#
# b2 <- read_csv("data/All bio_27_01_2022.csv") %>% select(CommonName, a, b) %>% distinct()
# write_csv(b2, "Data/a b values.csv")
ab <- read_csv("Data/a b values.csv")
bio <- read_csv("../../Murray cod recruitment/All bio_11_08_2023.csv")  %>% left_join(ab) %>%
mutate(CalcWeight = 10^(a)*Length_mm^b)
bio_summary <- bio %>% group_by(CommonName, OperationID) %>%
summarise(biomass_mean = mean(CalcWeight, na.rm=T))
catch2 <- all_data %>% left_join(bio_summary) %>% mutate(Taxa_biomass = biomass_mean * NumberCaught)
catch_total_biomass <- catch2  %>%
ungroup() %>% group_by(SamplingRecordID) %>%
summarise(Total_biomass = sum(Taxa_biomass, na.rm=T))
# method change
meths <- catch2 %>% select(SamplingRecordID, Method) %>% distinct() %>%
group_by(SamplingRecordID) %>% summarise(method_N =n())
table(meths$method_N)
catch2 <- catch2 %>% left_join(meths) %>% mutate(Method = case_when(method_N == 2 ~ "Hybrid",
T ~ Method)) %>%
select(-method_N)
table(catch2$Method)
duds <- c("Alpine Spiny Crayfish", "Australian Water Rat", "Bengal sergeant",
"Black bream", "Broad-shelled turtle", "Clayton's Spiny Crayfish",
"Eastern long-necked tortoise", "Eastern water dragon",
"Freshwater prawn, Murray crayfish", "Murray short-necked turtle",
"Platypus", "Riek's crayfish", "River mussel", "Shrimp",
"Sydney crayfish", "Trevally","Unidentified Euastacus",
"Unidentified Tadpole", "Unknown Shrimp", "Yabby",
"Zero catch at DRY site")
effort_by_op <- catch2  %>% group_by(OperationID) %>% summarise(ESecs = mean(ESecs, na.rm=T))
# catch2 <- catch2 %>% select(SampleDate, SiteID,SWWRPANAME_NEW, CommonName, SamplingRecordID, Method,Taxa_biomass, ESecs) %>% # ,Total_biomass, Biomass_proportion
#   group_by(SampleDate, SiteID,SWWRPANAME_NEW, CommonName, SamplingRecordID, Method) %>%
#   summarise(Taxa_biomass = sum(Taxa_biomass, na.rm=T), ESecs = sum(ESecs)) %>% ungroup() %>% left_join(catch_total_biomass) %>%
#   filter(Total_biomass >0) %>% mutate(Biomass_proportion = Taxa_biomass/Total_biomass) %>%
#   select(SampleDate, SiteID,ESecs,SWWRPANAME_NEW, CommonName, SamplingRecordID, Method,Taxa_biomass,Total_biomass, Biomass_proportion) %>%
#   drop_na(CommonName)
xx <- catch2 %>%
group_by(OperationID, Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Biomass, names_from = Alien, values_fill = 0) %>%
pivot_longer(7:8, names_to = "Category", values_to = "Biomass") %>%
left_join(effort_by_op) %>% drop_na(ESecs) %>% filter(ESecs >30) %>% mutate(Date = ymd_hms(SampleDate),
Year = year(Date),
Month = month(Date),
FinYear = case_when(Month>6 ~ Year+1,
T ~ Year),
FinYear = as.character(FinYear))
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs, na.rm=T),
Total_Biomass = sum(Biomass, na.rm=T)/1000,
std_Biomass = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass, na.rm=T),
sd_Biomass = mean(std_Biomass, na.rm=T),
n=n(),
se_Biomass = sd_Biomass/sqrt(n))
dat_sum2$Category_f = factor(dat_sum2$Category, levels=c('Native','Alien', 'Other'))
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (kg; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
View(dat_sum2)
View(catch2)
View(dat_sum)
View(mod_dat)
xx <- catch2 %>%
group_by(OperationID, Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Biomass, names_from = Alien, values_fill = 0)# %>%
xx <- catch2 %>%
group_by(OperationID, Alien, SiteID, SampleDate, SamplingRecordID,SWWRPANAME_NEW, Method) %>%
summarise(Biomass = sum(Taxa_biomass)) %>%
pivot_wider(values_from = Biomass, names_from = Alien, values_fill = 0) %>%
pivot_longer(7:9, names_to = "Category", values_to = "Biomass") %>%
left_join(effort_by_op) %>% drop_na(ESecs) %>% filter(ESecs >30) %>% mutate(Date = ymd_hms(SampleDate),
Year = year(Date),
Month = month(Date),
FinYear = case_when(Month>6 ~ Year+1,
T ~ Year),
FinYear = as.character(FinYear))
mod_dat <- xx %>% ungroup() %>%  filter(SampleDate >= as.Date("1994-07-01"))
dat_sum <- mod_dat %>% group_by(FinYear, Category, SamplingRecordID) %>%
summarise(Effort = sum(ESecs, na.rm=T),
Total_Biomass = sum(Biomass, na.rm=T)/1000,
std_Biomass = Total_Biomass/Effort * 90) %>% filter(FinYear <2024)
dat_sum2 <- dat_sum %>% group_by(FinYear, Category) %>%
summarise(Mean_Biomass = mean(std_Biomass, na.rm=T),
sd_Biomass = mean(std_Biomass, na.rm=T),
n=n(),
se_Biomass = sd_Biomass/sqrt(n))
dat_sum2$Category_f = factor(dat_sum2$Category, levels=c('Native','Alien', 'Other'))
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (kg; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
dat_sum2 <- dat_sum2 %>% filter(Category != "Other")
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (kg; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
ggsave("Matter 8 Mean Biomass Plot.png", dpi = 300, width = 15, height=14, units="cm")
View(dat_sum)
View(mod_dat)
ggplot(dat_sum2, aes(as.numeric(FinYear), Mean_Biomass)) + geom_col() +
facet_wrap(~Category_f, ncol=1) +
geom_errorbar(aes(ymin=Mean_Biomass-1.96*se_Biomass, ymax = Mean_Biomass+1.96*se_Biomass)) +
scale_x_continuous(breaks = seq(1998,2022,4))+
labs(y = "Mean Biomass (kg; 90s Electrofishing + 95% CI)", x = "Year Ending June 30th") +
theme_bw() + theme(axis.title = element_text(colour="black", face="bold", size=14),
axis.text = element_text(colour="black", size=12),
strip.text = element_text(colour="black", face="bold", size=12))
ggsave("Matter 8 Mean Biomass Plot.png", dpi = 300, width = 15, height=14, units="cm")
